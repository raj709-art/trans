<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web3 Contract Dashboard ‚Äî React + Ethers (Single File)</title>
  <!-- Ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <!-- React 18 UMD + Babel for in-browser JSX -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#9fb0d1; --text:#e7efff; --accent:#5dd0ff; --good:#2ecc71; --warn:#f1c40f; --bad:#e74c3c;
      --border: rgba(255,255,255,0.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#0b1220,#0e1627 30%,#0b1220);color:var(--text)}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    h1{font-size:28px;margin:0 0 12px;letter-spacing:0.2px}
    .sub{color:var(--muted);margin-bottom:24px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,0.2)}
    @media(min-width:900px){.span-4{grid-column:span 4}.span-6{grid-column:span 6}.span-8{grid-column:span 8}.span-3{grid-column:span 3}}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .btn{background:linear-gradient(90deg,#1c6cff,#4ec3ff);border:none;color:white;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;box-shadow:0 6px 20px rgba(76,175,255,0.25)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.secondary{background:#1b2438}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0f1a32;border:1px solid var(--border);color:var(--muted);font-size:12px}
    input, textarea, select{width:100%;background:#0f1626;border:1px solid var(--border);color:var(--text);padding:10px;border-radius:12px}
    textarea{min-height:120px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px}
    label{font-size:12px;color:var(--muted)}
    .kv{display:grid;grid-template-columns:160px 1fr;gap:8px;font-size:14px}
    .hr{height:1px;background:var(--border);margin:12px 0}
    .status{border-radius:12px;padding:12px;background:#0f1a32;border:1px solid var(--border);font-family:ui-monospace,monospace;white-space:pre-wrap}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tab{padding:8px 12px;border-radius:10px;border:1px solid var(--border);cursor:pointer;background:#0e1627;color:var(--muted)}
    .tab.active{background:#193356;color:#fff;border-color:#274a7b}
    .pill{padding:4px 8px;border-radius:999px;background:#12223f;border:1px solid var(--border);font-size:12px}
    .function{border:1px solid var(--border);border-radius:14px;padding:12px;background:#0e1627}
    .fn-title{font-weight:700;letter-spacing:.2px}
    .mono{font-family:ui-monospace,monospace}
    .muted{color:var(--muted)}
    .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .small{font-size:12px}
    .inline{display:inline-flex;gap:8px;align-items:center}
    .scroll{max-height:260px;overflow:auto;padding-right:6px}
    .footer{color:var(--muted);font-size:12px;margin-top:12px}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // ---------- Helpers ----------
    const short = (addr) => addr ? addr.slice(0,6)+"‚Ä¶"+addr.slice(-4) : "";
    const sleep = (ms) => new Promise(r=>setTimeout(r,ms));

    // Try-catch wrapper with friendly status messages
    async function tryTx(setStatus, fn){
      try{ setStatus('‚è≥ Sending transaction‚Ä¶');
        const tx = await fn();
        setStatus(`üì§ Submitted: ${tx.hash}\n‚õΩ Waiting for confirmations‚Ä¶`);
        const rc = await tx.wait();
        setStatus(`‚úÖ Success in block ${rc.blockNumber}\nTx: ${tx.hash}`);
        return rc;
      }catch(err){
        console.error(err);
        const msg = err?.error?.message || err?.reason || err?.message || String(err);
        setStatus(`‚ùå Error: ${msg}`);
        throw err;
      }
    }

    // Minimal AccessControl ABI (grant/revoke/renounce/hasRole + DEFAULT_ADMIN_ROLE)
    const ACCESS_CONTROL_MIN_ABI = [
      "function hasRole(bytes32 role, address account) view returns (bool)",
      "function getRoleAdmin(bytes32 role) view returns (bytes32)",
      "function grantRole(bytes32 role, address account)",
      "function revokeRole(bytes32 role, address account)",
      "function renounceRole(bytes32 role, address account)",
      "function DEFAULT_ADMIN_ROLE() view returns (bytes32)"
    ];

    function Header({account, chainId, connect}){
      return (
        <div className="card">
          <div className="row" style={{justifyContent:'space-between'}}>
            <div>
              <h1>Web3 Contract Dashboard</h1>
              <div className="sub">Single-file React + Ethers UI (paste your ABI & address below)</div>
            </div>
            <div className="row">
              <span className="badge mono">Network: {chainId ? chainId : '‚Äî'}</span>
              <span className="badge mono">Account: {account ? short(account) : '‚Äî'}</span>
              <button className="btn" onClick={connect}>{account? 'Reconnect' : 'Connect Wallet'}</button>
            </div>
          </div>
        </div>
      )
    }

    function ContractLoader({onLoaded, provider}){
      const [addr, setAddr] = useState("");
      const [abiText, setAbiText] = useState(`[
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "AccessControlBadConfirmation",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "bytes32",
				"name": "neededRole",
				"type": "bytes32"
			}
		],
		"name": "AccessControlUnauthorizedAccount",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			},
			{
				"internalType": "string[]",
				"name": "_descriptions",
				"type": "string[]"
			},
			{
				"internalType": "uint256[]",
				"name": "_amounts",
				"type": "uint256[]"
			}
		],
		"name": "addMilestones",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			}
		],
		"name": "approveProposal",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_totalAllocated",
				"type": "uint256"
			}
		],
		"name": "createBudgetCategory",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_reason",
				"type": "string"
			}
		],
		"name": "flagSuspiciousProposal",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_official",
				"type": "address"
			}
		],
		"name": "grantOfficialRole",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "ReentrancyGuardReentrantCall",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "categoryId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "totalAllocated",
				"type": "uint256"
			}
		],
		"name": "BudgetCreated",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "depositFunds",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_requiredApprovals",
				"type": "uint256"
			}
		],
		"name": "disburseEmergencyFund",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "EmergencyFundDisbursed",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_milestoneIndex",
				"type": "uint256"
			}
		],
		"name": "fundMilestone",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "depositor",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FundsDeposited",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "grantRole",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "milestoneIndex",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "MilestoneFunded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "approver",
				"type": "address"
			}
		],
		"name": "ProposalApproved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "flagger",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "reason",
				"type": "string"
			}
		],
		"name": "ProposalFlagged",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "rejector",
				"type": "address"
			}
		],
		"name": "ProposalRejected",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "budgetCategoryId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "ProposalSubmitted",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			}
		],
		"name": "rejectProposal",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"internalType": "address",
				"name": "callerConfirmation",
				"type": "address"
			}
		],
		"name": "renounceRole",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_official",
				"type": "address"
			}
		],
		"name": "revokeOfficialRole",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "revokeRole",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"indexed": true,
				"internalType": "bytes32",
				"name": "previousAdminRole",
				"type": "bytes32"
			},
			{
				"indexed": true,
				"internalType": "bytes32",
				"name": "newAdminRole",
				"type": "bytes32"
			}
		],
		"name": "RoleAdminChanged",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "RoleGranted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "RoleRevoked",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_budgetCategoryId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_description",
				"type": "string"
			},
			{
				"internalType": "address payable",
				"name": "_recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_requestedAmount",
				"type": "uint256"
			}
		],
		"name": "submitProposal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "budgetCategories",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "categoryId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "totalAllocated",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "totalSpent",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "DEFAULT_ADMIN_ROLE",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "flaggedReasons",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			}
		],
		"name": "getFlaggedReasons",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_proposalId",
				"type": "uint256"
			}
		],
		"name": "getProposalDetails",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "proposalId",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "budgetCategoryId",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "description",
						"type": "string"
					},
					{
						"internalType": "address payable",
						"name": "recipient",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "requestedAmount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "amountPaid",
						"type": "uint256"
					},
					{
						"internalType": "enum TransparentGovernmentBudget.ProposalStatus",
						"name": "status",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "approvalCount",
						"type": "uint256"
					}
				],
				"internalType": "struct TransparentGovernmentBudget.Proposal",
				"name": "",
				"type": "tuple"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "description",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "funded",
						"type": "bool"
					}
				],
				"internalType": "struct TransparentGovernmentBudget.Milestone[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			}
		],
		"name": "getRoleAdmin",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "GOV_ADMIN_ROLE",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "role",
				"type": "bytes32"
			},
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "hasRole",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "OFFICIAL_ROLE",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "proposalApprovals",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "proposalMilestones",
		"outputs": [
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "funded",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "proposals",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "proposalId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "budgetCategoryId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "address payable",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "requestedAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "amountPaid",
				"type": "uint256"
			},
			{
				"internalType": "enum TransparentGovernmentBudget.ProposalStatus",
				"name": "status",
				"type": "uint8"
			},
			{
				"internalType": "uint256",
				"name": "approvalCount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]`);
      const [status, setStatus] = useState("");

      const load = useCallback(()=>{
        try{
          setStatus("");
          if(!ethers.utils.isAddress(addr)) throw new Error("Invalid contract address");
          const abi = JSON.parse(abiText);
          const contract = new ethers.Contract(addr, abi, provider);
          onLoaded({address: addr, abi, contract});
        }catch(e){ setStatus("‚ùå " + (e.message || String(e))); }
      }, [addr, abiText, provider, onLoaded]);

      return (
        <div className="card">
          <div className="row" style={{justifyContent:'space-between', alignItems:'flex-start'}}>
            <div style={{flex:1, minWidth:280, marginRight:12}}>
              <label>Contract Address</label>
              <input placeholder="0x‚Ä¶" value={addr} onChange={e=>setAddr(e.target.value.trim())} />
              <div className="hr"></div>
              <label>ABI JSON</label>
              <textarea value={abiText} onChange={e=>setAbiText(e.target.value)} spellCheck={false}></textarea>
              <div className="row" style={{marginTop:12}}>
                <button className="btn" onClick={load}>Load Contract</button>
                <button className="btn secondary" onClick={()=>{setAbiText(JSON.stringify(ACCESS_CONTROL_MIN_ABI,null,2));}}>Insert Minimal AccessControl ABI</button>
              </div>
              {status && <div className="status" style={{marginTop:10}}>{status}</div>}
            </div>
            <div style={{flex:1, minWidth:260}}>
              <InfoTips />
            </div>
          </div>
        </div>
      )
    }

    function InfoTips(){
      return (
        <div>
          <h3 style={{marginTop:0}}>Quick tips</h3>
          <ul className="small muted">
            <li>Compile your Solidity in Remix/Foundry/Hardhat and copy the <span className="mono">ABI</span> JSON.</li>
            <li>Paste the deployed address (Sepolia/Mainnet/local) and click <b>Load Contract</b>.</li>
            <li>Read-only functions appear under <b>Citizen</b>. Transactions under <b>Official</b>.</li>
            <li>Role management (grant/revoke) is under <b>Admin</b> if your contract uses OpenZeppelin AccessControl.</li>
            <li>Status panel shows tx hash, confirmations, or errors (e.g., lack of role or wrong network).</li>
          </ul>
        </div>
      )
    }

    function RolesPanel({abi, address, provider, signer, account}){
      const [status, setStatus] = useState("");
      const [roles, setRoles] = useState([]); // [{name, id, has}]
      const [inputRole, setInputRole] = useState("");
      const [target, setTarget] = useState("");

      const ac = useMemo(()=>{
        try{ return new ethers.Contract(address, ACCESS_CONTROL_MIN_ABI, provider); }
        catch{ return null }
      },[address, provider]);

      const detectRoleConstants = useCallback(async()=>{
        if(!ac) return;
        const names = abi.filter(x=>x.type==='function' && x.inputs.length===0 && (x.outputs?.[0]?.type==='bytes32') && (/ROLE$/i.test(x.name) || x.name==='DEFAULT_ADMIN_ROLE')).map(x=>x.name);
        const out = [];
        for(const n of names){
          try{
            const id = await ac[n]();
            let has = false;
            try{ has = account ? await ac.hasRole(id, account) : false; }catch{}
            out.push({name:n, id, has});
          }catch{}
        }
        setRoles(out);
      },[abi, ac, account]);

      useEffect(()=>{ detectRoleConstants(); },[detectRoleConstants]);

      const grant = async()=>{
        const c = ac.connect(signer);
        await tryTx(setStatus, ()=> c.grantRole(inputRole, target));
        detectRoleConstants();
      }
      const revoke = async()=>{
        const c = ac.connect(signer);
        await tryTx(setStatus, ()=> c.revokeRole(inputRole, target));
        detectRoleConstants();
      }
      const renounce = async()=>{
        const c = ac.connect(signer);
        await tryTx(setStatus, ()=> c.renounceRole(inputRole, target || account));
        detectRoleConstants();
      }

      return (
        <div className="card span-4">
          <div className="row" style={{justifyContent:'space-between'}}>
            <h3 style={{margin:0}}>Admin</h3>
            <span className="pill">AccessControl</span>
          </div>
          <div className="small muted" style={{marginTop:6}}>Manage roles (requires admin privileges on-chain).</div>
          <div className="hr"></div>

          <div className="kv small">
            <div>Detected Roles</div>
            <div className="scroll">
              {roles.length===0 ? <span className="muted">No role constants detected in ABI.</span> : roles.map(r=> (
                <div key={r.name} className="row" style={{justifyContent:'space-between'}}>
                  <span className="mono">{r.name}</span>
                  <span className={"pill "+(r.has?"ok":"")}>{r.has?"You have" : "No"}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="hr"></div>
          <label>Role (bytes32 hex)</label>
          <input placeholder="0x‚Ä¶ (e.g., DEFAULT_ADMIN_ROLE id)" value={inputRole} onChange={e=>setInputRole(e.target.value.trim())}/>
          <label style={{marginTop:8}}>Target Address</label>
          <input placeholder="0x‚Ä¶" value={target} onChange={e=>setTarget(e.target.value.trim())}/>
          <div className="row" style={{marginTop:10}}>
            <button className="btn" onClick={grant} disabled={!inputRole || !ethers.utils.isAddress(target)}>Grant</button>
            <button className="btn secondary" onClick={revoke} disabled={!inputRole || !ethers.utils.isAddress(target)}>Revoke</button>
            <button className="btn secondary" onClick={renounce} disabled={!inputRole}>Renounce</button>
          </div>
          <div className="status" style={{marginTop:10}}>{status || '‚Äî'}</div>
        </div>
      )
    }

    function ReadFunctions({contract}){
      const [results, setResults] = useState({});

      const views = useMemo(()=> (contract.interface.fragments.filter(f=> f.type==='function' && (f.stateMutability==='view' || f.stateMutability==='pure'))), [contract]);

      const callFn = async (fn, idx, inputs)=>{
        try{
          const args = inputs.map(x=> x.value);
          const res = await contract[fn.name](...args);
          setResults(prev=>({...prev, [fn.name+idx]: String(res)}));
        }catch(e){ setResults(prev=>({...prev, [fn.name+idx]: '‚ùå '+(e.reason||e.message)})); }
      }

      return (
        <div className="card span-4">
          <div className="row" style={{justifyContent:'space-between'}}>
            <h3 style={{margin:0}}>Citizen</h3>
            <span className="pill">Read-only</span>
          </div>
          <div className="scroll" style={{marginTop:10}}>
            {views.length===0 && <div className="muted small">No view/pure functions in ABI.</div>}
            {views.map((fn, idx)=> (
              <div key={fn.name+idx} className="function" style={{marginBottom:10}}>
                <div className="fn-title">{fn.name} <span className="muted small">({fn.inputs.length} input{fn.inputs.length!==1?'s':''})</span></div>
                {fn.inputs.map((inp,i)=> (
                  <div key={i}>
                    <label>{inp.name || `arg${i}`} ‚Äî <span className="mono">{inp.type}</span></label>
                    <input data-key={`${fn.name+idx}-in-${i}`} placeholder={inp.type}/>
                  </div>
                ))}
                <div className="row" style={{marginTop:8, justifyContent:'space-between', alignItems:'center'}}>
                  <button className="btn" onClick={(e)=>{
                    const inputs = fn.inputs.map((_,i)=> e.currentTarget.parentElement.parentElement.querySelector(`input[data-key='${fn.name+idx}-in-${i}']`));
                    callFn(fn, idx, inputs);
                  }}>Call</button>
                  <div className="mono small">{results[fn.name+idx] || '‚Äî'}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )
    }

    function WriteFunctions({contract, signer}){
      const [status, setStatus] = useState("");

      const writes = useMemo(()=> (contract.interface.fragments.filter(f=> f.type==='function' && !(f.stateMutability==='view' || f.stateMutability==='pure'))), [contract]);

      const sendTx = async (fn, idx, inputs, payable){
        const args = inputs.map(x=> x.value);
        const connected = contract.connect(signer);
        await tryTx(setStatus, ()=> payable ? connected[fn.name](...args, { value: ethers.BigNumber.from(payable) }) : connected[fn.name](...args));
      }

      return (
        <div className="card span-4">
          <div className="row" style={{justifyContent:'space-between'}}>
            <h3 style={{margin:0}}>Official</h3>
            <span className="pill">Transactions</span>
          </div>
          <div className="scroll" style={{marginTop:10}}>
            {writes.length===0 && <div className="muted small">No state-changing functions in ABI.</div>}
            {writes.map((fn, idx)=> (
              <div key={fn.name+idx} className="function" style={{marginBottom:10}}>
                <div className="fn-title">{fn.name} <span className="muted small">({fn.stateMutability})</span></div>
                {fn.inputs.map((inp,i)=> (
                  <div key={i}>
                    <label>{inp.name || `arg${i}`} ‚Äî <span className="mono">{inp.type}</span></label>
                    <input data-key={`${fn.name+idx}-in-${i}`} placeholder={inp.type}/>
                  </div>
                ))}
                {fn.stateMutability==='payable' && (
                  <div>
                    <label>ETH Value (wei)</label>
                    <input data-key={`${fn.name+idx}-payable`} placeholder="0 (in wei)"/>
                  </div>
                )}
                <div className="row" style={{marginTop:8, justifyContent:'space-between', alignItems:'center'}}>
                  <button className="btn" onClick={(e)=>{
                    const inputs = fn.inputs.map((_,i)=> e.currentTarget.parentElement.parentElement.querySelector(`input[data-key='${fn.name+idx}-in-${i}']`));
                    const payable = fn.stateMutability==='payable' ? (e.currentTarget.parentElement.parentElement.querySelector(`input[data-key='${fn.name+idx}-payable']`)?.value || '0') : null;
                    sendTx(fn, idx, inputs, payable);
                  }}>Send</button>
                  <div className="status small" style={{flex:1, marginLeft:8}}>{status || '‚Äî'}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )
    }

    function ContractOverview({address, provider}){
      const [balance, setBalance] = useState("0");
      const [status, setStatus] = useState("");

      const refresh = useCallback(async()=>{
        try{
          const b = await provider.getBalance(address);
          setBalance(ethers.utils.formatEther(b));
          setStatus('‚úÖ Refreshed');
          await sleep(600);
          setStatus('');
        }catch(e){ setStatus('‚ùå '+(e.message||String(e))); }
      },[address, provider]);

      useEffect(()=>{ refresh(); },[refresh]);

      return (
        <div className="card span-3">
          <h3 style={{marginTop:0}}>Contract</h3>
          <div className="kv">
            <div>Address</div>
            <div className="mono">{address}</div>
            <div>Balance</div>
            <div className="mono">{balance} ETH</div>
          </div>
          <div className="row" style={{marginTop:12}}>
            <button className="btn secondary" onClick={refresh}>Refresh</button>
            {status && <span className="pill">{status}</span>}
          </div>
        </div>
      )
    }

    function Dashboard({loaded, provider, signer, account}){
      const { address, abi, contract } = loaded;
      return (
        <div className="grid">
          <ContractOverview address={address} provider={provider} />
          <RolesPanel abi={abi} address={address} provider={provider} signer={signer} account={account} />
          <ReadFunctions contract={contract} />
          <WriteFunctions contract={contract} signer={signer} />
        </div>
      )
    }

    function App(){
      const [provider, setProvider] = useState(null);
      const [signer, setSigner] = useState(null);
      const [account, setAccount] = useState(null);
      const [chainId, setChainId] = useState(null);
      const [loaded, setLoaded] = useState(null);
      const [globalStatus, setGlobalStatus] = useState('');

      const connect = useCallback(async()=>{
        if(!window.ethereum){ alert('MetaMask not detected. Install the extension and reload.'); return; }
        const web3Provider = new ethers.providers.Web3Provider(window.ethereum, 'any');
        await web3Provider.send('eth_requestAccounts', []);
        const s = web3Provider.getSigner();
        const acct = await s.getAddress();
        const network = await web3Provider.getNetwork();
        setProvider(web3Provider); setSigner(s); setAccount(acct); setChainId(network.chainId);
        setGlobalStatus(`üîó Connected ${acct} on chain ${network.chainId}`);
      },[]);

      // Handle network/account changes
      useEffect(()=>{
        if(!window.ethereum) return;
        const onAccounts = (accs)=>{ setAccount(accs?.[0] || null); };
        const onChain = (cid)=>{ setChainId(Number(cid)); };
        window.ethereum.on('accountsChanged', onAccounts);
        window.ethereum.on('chainChanged', onChain);
        return ()=>{
          try{ window.ethereum.removeListener('accountsChanged', onAccounts); }catch{}
          try{ window.ethereum.removeListener('chainChanged', onChain); }catch{}
        }
      },[]);

      return (
        <div className="container">
          <Header account={account} chainId={chainId} connect={connect} />
          {globalStatus && <div className="card status">{globalStatus}</div>}
          <ContractLoader onLoaded={setLoaded} provider={provider || new ethers.providers.JsonRpcProvider()} />
          {loaded && provider && signer ? (
            <Dashboard loaded={loaded} provider={provider} signer={signer} account={account} />
          ) : (
            <div className="card">
              <div className="muted">Load a contract (and connect your wallet) to enable the dashboard.</div>
            </div>
          )}
          <div className="footer">üí° Pro tip: Save this file as <span class="mono">index.html</span>, open it in your browser, paste your ABI & address, and connect MetaMask.</div>
        </div>
      )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
